<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitGud</title>
    <title>GitGud</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">

</head>
<body>
    <div class="gitai-logo">
        <span>GitGud</span>
    </div>
    <div class="theme-toggle">
        <span class="theme-icon">üåû</span>
        <label>
            <input type="checkbox" id="theme-toggle">
            <span class="slider"></span>
        </label>
        <span class="theme-icon">üåô</span>
    </div>

    <div id="loading">
        <div class="loading-spinner"></div>
        <p>Fetching repositories...</p>
        <p class="loading-status">This may take a little while</p>
    </div>

    <!-- New loading element for analyzing repos -->
    <div id="analyzing-loading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Analyzing repository...</p>
        <p class="loading-status">This may take a minute or two</p>
    </div>
    
    <div class="container">
        <!-- Add SVG GitHub logo before the GitGud heading -->
        <h1 style="display: flex; align-items: center;">
            <svg height="2em" viewBox="0 0 16 16" style="margin-right: 0.4em;" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="github-gradient" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0%" stop-color="#6366F1"/>
                        <stop offset="100%" stop-color="#A78BFA"/>
                    </linearGradient>
                </defs>
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
                0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52
                -.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2
                -3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64
                -.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08
                2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01
                1.93-.01 2.19 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
                fill="url(#github-gradient)"/>
            </svg>
            GitGud
        </h1>
        <p class="subtitle">Your personal GitHub evaluator</p>
        
        {% if error %}
            <div class="error-message">
                <p>{{ error }}</p>
                <p>Please try a different username or try again later.</p>
            </div>
        {% endif %}
        
        <div class="form-container">
            <form method="POST" onsubmit="showLoading()">
                <div class="form-group">
                    <label for="username">GitHub Username:</label>
                    <input type="text" id="username" name="username" required placeholder="Enter GitHub Username">
                    <button type="submit">Fetch Repos</button>
                </div>
            </form>
        </div>

        {% if results %}
            <div class="actions-container">
                <a href="/user-report/{{ username }}" class="report-button">Run Complete Analysis (Takes Time)</a>
            </div>

            <div class="repo-grid-header">
                <h2>Repositories</h2>
                <p>Click on any repository card below to analyze it individually.</p>
            </div>

            <div class="repo-grid">
                {% for repo in results %}
                    <div class="repo-card" onclick="window.location.href='/repo_details/{{ username }}/{{ repo.name }}'">
                        <h3>{{ repo.name }}</h3>
                        {% if repo.description %}
                            <p class="repo-description">{{ repo.description }}</p>
                        {% endif %}
                        <div class="repo-languages">
                            {% for language, bytes in repo.languages.items() %}
                                <span class="language-tag">{{ language }}</span>
                            {% endfor %}
                        </div>
                        
                        {% if repo.analyzed %}
                            <!-- Display scores for analyzed repos -->
                            <div class="score">
                                <span class="score-label">Security:</span>
                                <span class="score-value">
                                    {% if repo.security.score == "N/A" or repo.security.score == "Error" %}
                                        {{ repo.security.score }}
                                    {% else %}
                                        {{ repo.security.score|float|round|int }}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="score">
                                <span class="score-label">Efficiency:</span>
                                <span class="score-value">
                                    {% if repo.efficiency.score == "N/A" or repo.efficiency.score == "Error" %}
                                        {{ repo.efficiency.score }}
                                    {% else %}
                                        {{ repo.efficiency.score|float|round|int }}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="score">
                                <span class="score-label">Quality:</span>
                                <span class="score-value">
                                    {% if repo.quality.score == "N/A" or repo.quality.score == "Error" %}
                                        {{ repo.quality.score }}
                                    {% else %}
                                        {{ repo.quality.score|float|round|int }}
                                    {% endif %}
                                </span>
                            </div>
                            
                            <!-- Overall GitHub ELO Score -->
                            <div class="overall-score">
                                Overall ELO: 
                                {% if repo.overall_score == "N/A" or repo.overall_score == "Error" %}
                                    {{ repo.overall_score }}
                                {% else %}
                                    {{ repo.overall_score|float|round|int }}
                                {% endif %}
                            </div>
                        {% else %}
                            <!-- Display "Click to analyze" for unanalyzed repos -->
                            <div class="analyze-prompt">
                                <div class="analyze-message">Click to analyze this repository</div>
                                <div class="analyze-icon">üîç</div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <script>
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function showAnalyzingLoading() {
            document.getElementById('analyzing-loading').style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement;
            
            // Theme toggle functionality
            themeToggle.addEventListener('change', function() {
                if (this.checked) {
                    htmlElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    htmlElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }
            });
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                htmlElement.setAttribute('data-theme', 'dark');
                themeToggle.checked = true;
            }
            
            // Performance optimization for repository cards
            const repoCards = document.querySelectorAll('.repo-card');
            
            // Optimize loading with IntersectionObserver if available
            if ('IntersectionObserver' in window) {
                const observerOptions = {
                    rootMargin: '100px',
                    threshold: 0.1
                };
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                            observer.unobserve(entry.target);
                        }
                    });
                }, observerOptions);
                
                repoCards.forEach(card => {
                    observer.observe(card);
                });
            } else {
                // Fallback for browsers without IntersectionObserver
                repoCards.forEach(card => {
                    card.classList.add('visible');
                });
            }

            // Show analyzing loading when analyze prompt is clicked
            document.querySelectorAll('.analyze-prompt').forEach(function(el) {
                el.addEventListener('click', function(event) {
                    event.stopPropagation();
                    showAnalyzingLoading();
                    // Optionally, you may want to redirect after a short delay
                    // setTimeout(() => { ... }, 300);
                });
            });
        });
    </script>
</body>
</html>